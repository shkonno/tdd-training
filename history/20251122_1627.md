# TDD JWT認証プロジェクト - セッション履歴

**日時**: 2025-11-22

---

## 1. プロジェクト概要の決定

### 議論内容
- TDDチューターとしての役割を依頼された
- 3つのテーマを提案：FizzBuzz拡張、文字列計算機、ショッピングカート
- ユーザーがUIあり＋Docker＋Webを希望
- ログイン機能をTDDで実装することに決定

### 決定事項
- **テーマ**: ログイン認証機能
- **特徴**: 複数のアーキテクチャパターンを比較しながら学ぶ

---

## 2. アーキテクチャパターンの選定

### 検討したパターン
1. セッションベース認証
2. JWT (JSON Web Token) 認証
3. OAuth 2.0 / ソーシャルログイン
4. パスワードレス認証（マジックリンク）

### 決定事項
- **選択**: パターン2（JWT認証）を中心に4週間で進める
- **技術スタック**:
  - バックエンド: Python 3.11 + FastAPI
  - フロントエンド: Next.js 14 + TypeScript
  - DB: PostgreSQL 15 (Docker)
  - Cache: Redis 7 (Docker)
  - テスト: pytest + testcontainers

---

## 3. イシューリスト作成

### 作成内容
- 全29イシューをWeek別に整理
- `issues.md`に書き出し
- TDDテスト対象と状態管理用チェックボックスを追加

### イシュー構成
- Week 1: 基盤構築 + 純粋関数のTDD（#1-6）
- Week 2: ユーザー登録のTDD + UI（#7-12）
- Week 3: ログイン + セッション管理のTDD（#13-19）
- Week 4: トークンリフレッシュ + OAuth（#20-25）
- 横断的イシュー（#26-29）

---

## 4. イシュー #1: Docker Compose環境セットアップ

### 完了したステップ

#### ステップ 1: .gitignore作成 ✅
- Python + Node.js + Docker用の除外設定
- Claude/Kiro設定ファイルも除外

#### ステップ 2: docker-compose.yml作成 ✅
- PostgreSQL 15（ポート5432）
- Redis 7（ポート6379）
- Backend FastAPI（ポート8000）
- Frontend Next.js（ポート3000）

#### ステップ 3: backend/Dockerfile作成 ✅
- `backend/Dockerfile`
- `backend/requirements.txt`
- `backend/main.py`（スケルトン）

#### ステップ 4: frontend/Dockerfile作成 ✅
- `frontend/Dockerfile`
- `frontend/package.json`
- `frontend/tsconfig.json`
- `frontend/next.config.js`
- `frontend/app/layout.tsx`
- `frontend/app/page.tsx`

#### ステップ 5: Docker Compose起動確認 ⏳
- Docker Desktop未起動エラーが発生
- 解決方法を案内済み

---

## 5. 技術的な質問と回答

### Q1: PostgreSQLの役割
- **回答**: PostgreSQLは1つのみ。バックエンドが接続してデータを読み書きする永続層。
- 用語整理：バックエンド（FastAPI）、永続層（PostgreSQL）、インフラ層（DB接続コード）

### Q2: Redisの役割
- **用途**:
  1. セッション管理（高速アクセス）
  2. トークンブラックリスト（JWT無効化）
  3. レート制限（将来の拡張）
- **PostgreSQLとの違い**: PostgreSQLは永続保存、Redisは高速な一時データ管理

---

## 6. 次のステップ

1. Docker Desktopを起動
2. `docker-compose up --build`を実行
3. 動作確認後、イシュー #1 完了
4. イシュー #2-4（FastAPI/Next.jsスケルトン）へ進む
5. イシュー #5-6（TDDサイクル開始）

---

## 作成されたファイル一覧

```
tdd-training/
├── .gitignore
├── docker-compose.yml
├── issues.md
├── README.md
├── backend/
│   ├── Dockerfile
│   ├── requirements.txt
│   └── main.py
├── frontend/
│   ├── Dockerfile
│   ├── package.json
│   ├── tsconfig.json
│   ├── next.config.js
│   └── app/
│       ├── layout.tsx
│       └── page.tsx
└── history/
    └── 20251122_000000.md (このファイル)
```

---

## TDD学習のポイント（t_wada/Kent Beck式）

- **Red**: 失敗するテストを先に書く
- **Green**: 最小限の実装でテストを通す
- **Refactor**: コードをきれいにする
- 小さなステップで進める
- 「動作するきれいなコード」を目指す
